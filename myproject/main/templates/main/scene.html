{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Step 5 - Scenes</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        .step {
            text-align: center;
            margin: 0 15px;
            color: #6c757d;
            text-decoration: none;
        }
        .step div {
            width: 50px;
            height: 50px;
            line-height: 50px;
            border-radius: 50%;
            border: 2px solid #6c757d;
            margin: 0 auto 5px;
            font-weight: bold;
        }
        .step.active div {
            background-color: #6c757d;
            color: white;
        }
        .step.completed div {
            background-color: #198754;
            border-color: #198754;
            color: white;
        }
        .step.disabled {
            pointer-events: none;
            opacity: 0.5;
        }
        .carousel-item {
            min-height: 300px;
        }
        .carousel-indicators {
            position: relative;
            margin: 0;
        }
        .carousel-indicators [data-bs-target] {
            background-color: #6c757d;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            opacity: 0.5;
        }
        .carousel-indicators .active {
            opacity: 1;
        }
        .scene-image {
            width: 50%;
            height: auto;
            margin: 0 auto;
            display: block;
        }
        .carousel-inner {
          min-height: 800px; 
        }
    </style>
</head>
<body class="bg-light">

    <!-- Navbar - Steps 1–3 completed, Step 4 active -->
    <nav class="d-flex justify-content-center py-4 bg-white">
        <div class="step disabled">
            <div>1</div>
            <small>Idea</small>
        </div>
        <div class="step disabled">
            <div>2</div>
            <small>Draft</small>
        </div>
        <a href="{% url 'personas' %}" class="step completed">
            <div>3</div>
            <small>Personas</small>
        </a>
        <a href="{% url 'locations' %}" class="step completed">
            <div>4</div>
            <small>Locations</small>
        </a>
        <div class="step active">
            <div>5</div>
            <small>Scene</small>
        </div>
    </nav>

    <div class="container mt-5">
        <h4 class="mb-2 text-center">Scenes</h4>
        <p class="text-muted text-center mb-4">
            Here you can edit what each scene looks like for the story.
        </p>

        <div class="card shadow-sm mx-auto p-4" style="max-width: 700px;">

            <!-- Carousel -->
            <div id="scenesCarousel" class="carousel slide mb-4" data-bs-ride="false">
              <div class="carousel-inner">

                <!-- Scene 1 -->
                <div class="carousel-item active" data-location="1">
                  <h2 class="text-center">Scene 1</h2>
                  <img src="{% static 'main/images/exampleImage.png' %}" alt="Scene illustration" class="d-block w-100 scene-image">
                  <div class="text-center my-3">
                    <form method="post" action="{% url 'scene' %}">
                        {% csrf_token %}
                        <input type="hidden" name="location_id" value="1">
                        <button type="submit" class="btn btn-outline-secondary">
                            <i class="bi bi-arrow-clockwise me-1"></i> Regenerate Image
                        </button>
                    </form>
                  </div>
                  <div class="row g-4 mb-4">
                    <div class="col-md-6">
                      <label class="form-label fw-bold text-secondary">Image Description</label>
                      <p><a href="{% url 'personas' %}">Bob</a> waits on the rainy city street, his wheelchair positioned near the curb under a flickering lamppost. Water pools around the wheels, catching reflections of neon lights and passing cars. He checks his phone, watching the Uber timer count down. The air smells of wet asphalt and distant exhaust, wrapping the moment in damp stillness and faint hope.</p>
                    </div>
                    <div class="col-md-6">
                      <label class="form-label fw-bold text-secondary">Narration</label>
                      <p>The rain had already been falling for an hour, steady and unbothered. Bob (muttering): “Come on, five minutes... let’s hope this one’s on time.” He adjusts his jacket collar and tucks his phone into his lap. The app glows faintly: Driver arriving in 3 minutes.</p>
                    </div>
                  </div>
                </div>

                <!-- Scene 2 -->
                <div class="carousel-item" data-location="2">
                  <h2 class="text-center">Scene 2</h2>
                  <img src="{% static 'main/images/exampleImage.png' %}" alt="Scene illustration" class="d-block w-100 scene-image">
                  <div class="text-center my-3">
                    <form method="post" action="{% url 'scene' %}">
                        {% csrf_token %}
                        <input type="hidden" name="location_id" value="1">
                        <button type="submit" class="btn btn-outline-secondary">
                            <i class="bi bi-arrow-clockwise me-1"></i> Regenerate Image
                        </button>
                    </form>
                  </div>
                  <div class="row g-4 mb-4">
                    <div class="col-md-6">
                      <label class="form-label fw-bold text-secondary">Image Description</label>
                      <p><a href="{% url 'personas' %}">Claire</a> waits by the <a href="{% url 'locations' %}">City Street</a></p>
                    </div>
                    <div class="col-md-6">
                      <label class="form-label fw-bold text-secondary">Narration</label>
                      <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
                    </div>
                  </div>
                </div>

                <!-- Scene 3 -->
                <div class="carousel-item" data-location="3">
                  <h2 class="text-center">Scene 3</h2>
                  <img src="{% static 'main/images/exampleImage.png' %}" alt="Scene illustration" class="d-block w-100 scene-image">
                  <div class="text-center my-3">
                    <form method="post" action="{% url 'scene' %}">
                        {% csrf_token %}
                        <input type="hidden" name="location_id" value="1">
                        <button type="submit" class="btn btn-outline-secondary">
                            <i class="bi bi-arrow-clockwise me-1"></i> Regenerate Image
                        </button>
                    </form>
                  </div>
                  <div class="row g-4 mb-4">
                    <div class="col-md-6">
                      <label class="form-label fw-bold text-secondary">Image Description</label>
                      <p><a href="{% url 'personas' %}">Billy</a> Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
                    </div>
                    <div class="col-md-6">
                      <label class="form-label fw-bold text-secondary">Narration</label>
                      <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
                    </div>
                  </div>
                </div>

                <!-- Scene 4 -->
                <div class="carousel-item" data-location="4">
                  <h2 class="text-center">Scene 4</h2>
                  <img src="{% static 'main/images/exampleImage.png' %}" alt="Scene illustration" class="d-block w-100 scene-image">
                  <div class="text-center my-3">
                    <form method="post" action="{% url 'scene' %}">
                        {% csrf_token %}
                        <input type="hidden" name="location_id" value="1">
                        <button type="submit" class="btn btn-outline-secondary">
                            <i class="bi bi-arrow-clockwise me-1"></i> Regenerate Image
                        </button>
                    </form>
                  </div>
                  <div class="row g-4 mb-4">
                    <div class="col-md-6">
                      <label class="form-label fw-bold text-secondary">Image Description</label>
                      <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
                    </div>
                    <div class="col-md-6">
                      <label class="form-label fw-bold text-secondary">Narration</label>
                      <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
                    </div>
                  </div>
                </div>

                <!-- Scene 5 -->
                <div class="carousel-item" data-location="5">
                  <h2 class="text-center">Scene 5</h2>
                  <img src="{% static 'main/images/exampleImage.png' %}" alt="Scene illustration" class="d-block w-100 scene-image">
                  <div class="text-center my-3">
                    <form method="post" action="{% url 'scene' %}">
                        {% csrf_token %}
                        <input type="hidden" name="location_id" value="1">
                        <button type="submit" class="btn btn-outline-secondary">
                            <i class="bi bi-arrow-clockwise me-1"></i> Regenerate Image
                        </button>
                    </form>
                  </div>
                  <div class="row g-4 mb-4">
                    <div class="col-md-6">
                      <label class="form-label fw-bold text-secondary">Image Description</label>
                      <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
                    </div>
                    <div class="col-md-6">
                      <label class="form-label fw-bold text-secondary">Narration</label>
                      <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
                    </div>
                  </div>
                </div>

                <!-- Scene 6 -->
                <div class="carousel-item" data-location="6">
                  <h2 class="text-center">Scene 6</h2>
                  <img src="{% static 'main/images/exampleImage.png' %}" alt="Scene illustration" class="d-block w-100 scene-image">
                  <div class="text-center my-3">
                    <form method="post" action="{% url 'scene' %}">
                        {% csrf_token %}
                        <input type="hidden" name="location_id" value="1">
                        <button type="submit" class="btn btn-outline-secondary">
                            <i class="bi bi-arrow-clockwise me-1"></i> Regenerate Image
                        </button>
                    </form>
                  </div>
                  <div class="row g-4 mb-4">
                    <div class="col-md-6">
                      <label class="form-label fw-bold text-secondary">Image Description</label>
                      <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
                    </div>
                    <div class="col-md-6">
                      <label class="form-label fw-bold text-secondary">Narration</label>
                      <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
                    </div>
                  </div>
                </div>

              </div>

              <!-- Carousel indicators -->
              <div class="carousel-indicators position-relative mt-3">
                <button type="button" data-bs-target="#scenesCarousel" data-bs-slide-to="0" class="active" aria-current="true"></button>
                <button type="button" data-bs-target="#scenesCarousel" data-bs-slide-to="1"></button>
                <button type="button" data-bs-target="#scenesCarousel" data-bs-slide-to="2"></button>
                <button type="button" data-bs-target="#scenesCarousel" data-bs-slide-to="3"></button>
                <button type="button" data-bs-target="#scenesCarousel" data-bs-slide-to="4"></button>
                <button type="button" data-bs-target="#scenesCarousel" data-bs-slide-to="5"></button>
              </div>
            </div>

            <!-- Feedback Forms -->
            <div class="row">
              <!-- Image Description Form -->
              <div class="col-md-6">
                <form method="post" action="{% url 'scene' %}" id="imageDescriptionForm">
                    {% csrf_token %}
                    <input type="hidden" name="location_id" id="imageDescriptionLocation" value="1">
                    
                    <div class="position-relative mb-4">
                        <textarea 
                            class="form-control" 
                            name="image_description_feedback" 
                            id="imageDescriptionFeedback"
                            rows="4" 
                            placeholder="Edit Image Description..."
                        ></textarea>
                        <button 
                            type="submit" 
                            name="action" 
                            value="regenerate_image" 
                            class="btn btn-link position-absolute top-0 end-0 mt-2 me-2"
                            style="font-size: 1.5rem; color: #6c757d;"
                        >
                            <i class="bi bi-send"></i>
                        </button>
                    </div>
                </form>
              </div>

              <!-- Narration Form -->
              <div class="col-md-6">
                <form method="post" action="{% url 'scene' %}" id="narrationForm">
                    {% csrf_token %}
                    <input type="hidden" name="location_id" id="narrationLocation" value="1">
                    
                    <div class="position-relative mb-4">
                        <textarea 
                            class="form-control" 
                            name="narration_feedback" 
                            id="narrationFeedback"
                            rows="4" 
                            placeholder="Edit Narration..."
                        ></textarea>
                        <button 
                            type="submit" 
                            name="action" 
                            value="regenerate_narration" 
                            class="btn btn-link position-absolute top-0 end-0 mt-2 me-2"
                            style="font-size: 1.5rem; color: #6c757d;"
                        >
                            <i class="bi bi-send"></i>
                        </button>
                    </div>
                </form>
              </div>
              <div class="d-flex justify-content-end">
                <form method="post" action="{% url 'video' %}">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-primary">Next →</button>
                </form>
            </div>

        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Update location ID on slide change
        const carousel = document.getElementById('scenesCarousel');
        carousel.addEventListener('slide.bs.carousel', function (event) {
            const locationId = event.relatedTarget.getAttribute('data-location');
            document.getElementById('locationId').value = locationId;
            // Clear feedback text when switching locations
            document.getElementById('feedbackText').value = '';
        });
    </script>
</body>
</html>